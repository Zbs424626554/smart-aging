# Smart Aging - Windows Nginx HTTPS reverse proxy

map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

server {
  listen              443 ssl;
  server_name         api.dev.local;

  ssl_certificate C:/nginx/certs/dev.local.crt;
  ssl_certificate_key C:/nginx/certs/dev.local.key;
  location /ws {
    proxy_pass              http://127.0.0.1:3001/ws;
    proxy_http_version      1.1;
    proxy_set_header        Upgrade $http_upgrade;
    proxy_set_header        Connection $connection_upgrade;
    proxy_set_header        Host $host;
    proxy_read_timeout      3600s;
  }

  location /api/ {
    proxy_pass         http://127.0.0.1:3001/api/;
    proxy_set_header   Host $host;
    proxy_set_header   X-Real-IP $remote_addr;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
  }
}

server {
  listen              443 ssl;
  server_name         family.dev.local;

  ssl_certificate     C:/nginx/certs/dev.local.crt;
  ssl_certificate_key C:/nginx/certs/dev.local.key;

  location / {
    proxy_pass         http://127.0.0.1:5174/;
    proxy_set_header   Host $host;
    proxy_set_header   X-Real-IP $remote_addr;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
  }
}

server {
  listen              443 ssl;
  server_name         elderly.dev.local;

  ssl_certificate     C:/nginx/certs/dev.local.crt;
  ssl_certificate_key C:/nginx/certs/dev.local.key;

  location / {
    proxy_pass         http://127.0.0.1:5173/;
    proxy_set_header   Host $host;
    proxy_set_header   X-Real-IP $remote_addr;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
  }
}

server {
  listen              443 ssl;
  server_name         nurse.dev.local;

  ssl_certificate     C:/nginx/certs/dev.local.crt;
  ssl_certificate_key C:/nginx/certs/dev.local.key;

  location / {
    proxy_pass         http://127.0.0.1:5175/;
    proxy_set_header   Host $host;
    proxy_set_header   X-Real-IP $remote_addr;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
  }
}

# 可选：HTTP 80 重定向到 HTTPS
server {
  listen      80;
  server_name api.dev.local family.dev.local elderly.dev.local nurse.dev.local;
  return 301 https://$host$request_uri;
}


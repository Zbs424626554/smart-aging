# AI模块配置与使用指南

## 概述

智慧养老平台的AI模块主要提供健康监测与预警功能，通过分析用户的健康数据，智能识别异常情况并生成预警通知。

## 功能特性

### 1. 健康监测与预警
- **多指标分析**: 支持血压、血糖、心率等健康指标分析
- **智能预警**: 根据医学标准自动识别异常情况
- **风险分级**: 0-3级风险等级，对应不同预警级别
- **趋势分析**: 分析健康数据变化趋势
- **个性化建议**: 根据风险等级生成针对性建议

### 2. 定时监控
- **自动检查**: 每天上午9点自动执行健康检查
- **异常通知**: 检测到异常时自动发送通知给老人和家属
- **数据统计**: 提供健康数据统计和趋势分析

## 第三方AI接口配置

### 推荐方案：百度智能云AI

#### 1. 注册百度智能云账号
访问 [百度智能云官网](https://cloud.baidu.com/)，注册账号并开通AI服务。

#### 2. 创建AI应用
1. 进入控制台，选择"产品服务" -> "人工智能"
2. 开通"自然语言处理"服务
3. 创建应用，获取以下信息：
   - APP_ID
   - API_KEY
   - SECRET_KEY

#### 3. 环境变量配置
在 `server/.env` 文件中添加以下配置：

```env
# 百度AI配置
BAIDU_AI_APP_ID=your-baidu-ai-app-id
BAIDU_AI_API_KEY=your-baidu-ai-api-key
BAIDU_AI_SECRET_KEY=your-baidu-ai-secret-key
```

### 备选方案：阿里云智能医疗

如果需要更专业的医疗AI服务，可以考虑阿里云智能医疗：
- 提供更专业的健康风险评估
- 支持更多医疗指标分析
- 有专门的健康管理解决方案

## 安装依赖

在 `server` 目录下安装AI相关依赖：

```bash
cd server
npm install baidu-aip node-cron
npm install --save-dev @types/node-cron
```

## API接口说明

### 1. 获取健康分析报告
```
GET /api/ai/health/analysis/:elderlyId
```

**响应示例**:
```json
{
  "success": true,
  "data": {
    "warningLevel": 2,
    "trendAnalysis": "检测到血压指标异常，建议及时关注并咨询医生。",
    "recommendations": [
      "血压异常，建议立即就医检查",
      "建议近期安排医生复查",
      "调整作息时间，保证充足睡眠"
    ],
    "riskScore": 65.5
  }
}
```

### 2. 手动触发健康检查
```
POST /api/ai/health/check/:elderlyId
```

### 3. 获取健康数据趋势
```
GET /api/ai/health/trends/:elderlyId?days=30&type=bloodPressure
```

### 4. 获取健康建议
```
GET /api/ai/health/recommendations/:elderlyId
```

### 5. 启动AI健康监控（管理员）
```
POST /api/ai/health/monitoring/start
```

## 健康数据标准

### 血压分级标准
- **正常**: < 140/90 mmHg
- **轻度高血压**: 140-159/90-99 mmHg
- **中度高血压**: 160-179/100-109 mmHg
- **重度高血压**: ≥ 180/110 mmHg
- **低血压**: < 90/60 mmHg

### 血糖分级标准（空腹）
- **正常**: 3.9-5.6 mmol/L
- **临界高血糖**: 5.6-6.1 mmol/L
- **糖尿病前期**: 6.1-7.0 mmol/L
- **糖尿病**: ≥ 7.0 mmol/L
- **低血糖**: < 3.9 mmol/L

### 心率分级标准
- **正常**: 60-90 次/分
- **临界异常**: 50-60 或 90-100 次/分
- **异常**: < 50 或 > 100 次/分

## 使用流程

### 1. 启动服务
```bash
# 启动后端服务
npm run start:server

# 启动老人端
npm run dev:elderly
```

### 2. 配置环境变量
确保 `.env` 文件中包含正确的百度AI配置。

### 3. 记录健康数据
在老人端健康管理页面：
1. 使用"记录健康数据"功能录入血压、血糖等数据
2. 系统会自动分析数据并生成报告

### 4. 查看健康分析
- 页面会自动显示健康风险等级和评分
- 如有异常会显示预警提醒
- 可查看详细的健康建议

### 5. 手动健康检查
点击"立即健康检查"按钮，系统会：
- 分析最近30天的健康数据
- 生成风险评估报告
- 如有异常自动发送通知

## 定时任务

系统配置了定时健康检查任务，每天上午9点自动执行：
- 获取所有老人用户的健康数据
- 执行AI分析
- 如有异常自动创建预警通知

## 通知机制

### 预警通知类型
1. **health_warning**: 老人端健康预警
2. **elderly_health_warning**: 家属端老人健康预警

### 通知内容
- 预警级别和风险评分
- 异常指标说明
- 个性化健康建议
- 紧急程度标识

## 扩展功能

### 1. 集成更多AI服务
可以在 `HealthService` 中集成其他AI服务：
- 语音识别（紧急呼叫分析）
- 图像识别（健康报告分析）
- 自然语言处理（健康咨询）

### 2. 机器学习模型
考虑训练自定义的机器学习模型：
- 基于历史数据预测健康风险
- 个性化健康建议生成
- 异常模式识别

### 3. 第三方健康设备集成
- 智能血压计数据同步
- 血糖仪数据接入
- 可穿戴设备数据整合

## 故障排除

### 常见问题

1. **百度AI接口调用失败**
   - 检查API密钥配置是否正确
   - 确认账户余额充足
   - 查看API调用频率限制

2. **健康分析结果异常**
   - 检查健康数据格式是否正确
   - 确认数据时间范围
   - 验证分析算法参数

3. **定时任务不执行**
   - 检查服务器时间设置
   - 确认cron表达式正确
   - 查看服务器日志

### 日志查看
```bash
# 查看服务器日志
tail -f server/logs/app.log

# 查看AI模块日志
grep "AI" server/logs/app.log
```

## 安全注意事项

1. **API密钥安全**
   - 不要在代码中硬编码API密钥
   - 使用环境变量管理敏感信息
   - 定期轮换API密钥

2. **数据隐私**
   - 健康数据加密存储
   - 访问权限严格控制
   - 符合医疗数据保护法规

3. **系统安全**
   - 定期更新依赖包
   - 监控异常访问
   - 备份重要数据

## 性能优化

1. **缓存策略**
   - 缓存健康分析结果
   - 减少重复计算
   - 优化数据库查询

2. **异步处理**
   - 健康分析异步执行
   - 通知发送异步处理
   - 避免阻塞主线程

3. **资源管理**
   - 控制API调用频率
   - 优化内存使用
   - 监控系统资源

## 联系支持

如有问题或建议，请联系开发团队或查看项目文档。 